# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å¸³

React ã§å‹•ä½œã™ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã‚’ã€Supabase ã¨ Google OAuth ã‚’åˆ©ç”¨ã—ã¦ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚Cloudflare Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã§ Web ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰äºˆå®šã‚’é–²è¦§ãƒ»ç·¨é›†ã§ãã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- ğŸ“… äºˆå®šãƒ»ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆçµ‚æ—¥ã€æ™‚é–“æŒ‡å®šã€é€šçŸ¥ã€ã‚¿ã‚¹ã‚¯ãƒã‚§ãƒƒã‚¯ãªã©æ—¢å­˜æ©Ÿèƒ½ã¯ãã®ã¾ã¾ï¼‰
- ğŸ” Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚ˆã‚‹ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼ˆSupabase Auth / Google OAuthï¼‰
- â˜ï¸ Supabase PostgreSQL ã¸ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«äºˆå®šã‚’ä¿å­˜ï¼ˆRow Level Security å¯¾å¿œï¼‰
- ğŸ” ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒ
- ğŸŒ Cloudflare Pages ã§ã® Web å…¬é–‹

## å¿…è¦ãªç’°å¢ƒå¤‰æ•°

`.env` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼ˆ`.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ï¼‰ã€‚

```
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...
VITE_SUPABASE_REDIRECT_URL=http://localhost:5173/auth/callback
VITE_VAPID_PUBLIC_KEY=...
```

- `VITE_SUPABASE_URL` / `VITE_SUPABASE_ANON_KEY`
	- Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® URL ã¨ anon ã‚­ãƒ¼ã€‚
- `VITE_SUPABASE_REDIRECT_URL`
	- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã® OAuth ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã€‚Cloudflare Pages ã¸å…¬é–‹ã—ãŸã‚‰æœ¬ç•ª URLï¼ˆä¾‹: `https://<your-pages>.pages.dev/auth/callback`ï¼‰ã«å¤‰æ›´ã—ã¾ã™ã€‚

- `VITE_VAPID_PUBLIC_KEY`
	- Web Push ã®è³¼èª­ï¼ˆsubscribeï¼‰ã«ä½¿ã† VAPID å…¬é–‹éµï¼ˆBase64URL å½¢å¼ï¼‰ã€‚
	- iOS ã§ã¯ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ãŸ Web ã‚¢ãƒ—ãƒªï¼ˆPWAï¼‰ã‹ã‚‰è¨±å¯/è³¼èª­ã—ã¦ãã ã•ã„ã€‚

> âš ï¸ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã§é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ã€‚æ¼æ´©ã—ãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

## Supabase è¨­å®š

1. **èªè¨¼è¨­å®š**
	 - Supabase Auth ã®è¨­å®šã§ Google ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã—ã€Google Cloud Console ã® OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID / ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚
	 - Supabase ã®ã€ŒAllowed Redirect URLsã€ã«ä»¥ä¸‹ã‚’ã™ã¹ã¦è¿½åŠ ã—ã¾ã™ã€‚
		 - `http://localhost:5173/auth/callback`
		 - Web å…¬é–‹å…ˆï¼ˆä¾‹: `https://<your-pages>.pages.dev/auth/callback`ï¼‰

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**
	 - `schedules` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚æ¨å¥¨ã‚¹ã‚­ãƒ¼ãƒï¼ˆä¸€ä¾‹ï¼‰ï¼š

		 ```sql
		 create table public.schedules (
			 id uuid primary key default gen_random_uuid(),
			 user_id uuid not null references auth.users(id) on delete cascade,
			 date text not null,
			 time text,
			 name text not null,
			 memo text,
			 all_day boolean not null default false,
			 all_day_order integer not null default 0,
			 notifications jsonb not null default '[]'::jsonb,
			 is_task boolean not null default false,
			 completed boolean not null default false,
			 created_at timestamp with time zone default now(),
			 updated_at timestamp with time zone default now()
		 );
     
		 alter table public.schedules enable row level security;
     
		 create policy "Read own schedules"
			 on public.schedules for select
			 using (auth.uid() = user_id);
     
		 create policy "Modify own schedules"
			 on public.schedules for all
			 using (auth.uid() = user_id)
			 with check (auth.uid() = user_id);
		 ```

	 - ã€Œæ›´æ–°æ—¥æ™‚ã€ã‚’è‡ªå‹•ã§ç®¡ç†ã—ãŸã„å ´åˆã¯ãƒˆãƒªã‚¬ãƒ¼ã§ `updated_at` ã‚’æ›´æ–°ã™ã‚‹ãªã©èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

	 - **ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆæ–°æ©Ÿèƒ½ï¼‰**
	 	- 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ãçŠ¶æ…‹ã‚’1è¡Œã§æŒã¤ `loop_timeline_state` ã¨ã€è¿½åŠ é …ç›®ã‚’æŒã¤ `loop_timeline_markers` ã‚’ä½œæˆã—ã¾ã™ï¼ˆæ¨å¥¨ã‚¹ã‚­ãƒ¼ãƒä¾‹ï¼‰ã€‚
	 	- `start_delay_minutes` ã¯å®Ÿè£…ä¸Šã¯ã€Œé–‹å§‹ã™ã‚‹æ™‚åˆ»ã®åˆ†ï¼ˆ0ã€œ59ã€ç©ºæ¬„ãªã‚‰å³æ™‚é–‹å§‹ï¼‰ã€ã¨ã—ã¦æ‰±ã„ã¾ã™ï¼ˆåˆ—åã¯äº’æ›ã®ãŸã‚ç¶­æŒï¼‰ã€‚

	 	```sql
	 	create table public.loop_timeline_state (
	 	  user_id uuid primary key references auth.users(id) on delete cascade,
	 	  duration_minutes integer not null default 60,
	 	  start_delay_minutes integer not null default 0,
	 	  start_at timestamptz,
	 	  status text not null default 'idle',
	 	  created_at timestamptz not null default now(),
	 	  updated_at timestamptz not null default now()
	 	);

	 	create table public.loop_timeline_markers (
	 	  id bigint generated by default as identity primary key,
	 	  user_id uuid not null references auth.users(id) on delete cascade,
	 	  text text not null,
	 	  offset_minutes integer not null default 0,
	 	  created_at timestamptz not null default now(),
	 	  updated_at timestamptz not null default now()
	 	);

	 	alter table public.loop_timeline_state enable row level security;
	 	alter table public.loop_timeline_markers enable row level security;

	 	create policy "Read own loop timeline state"
	 	  on public.loop_timeline_state for select
	 	  using (auth.uid() = user_id);

	 	create policy "Modify own loop timeline state"
	 	  on public.loop_timeline_state for all
	 	  using (auth.uid() = user_id)
	 	  with check (auth.uid() = user_id);

	 	create policy "Read own loop timeline markers"
	 	  on public.loop_timeline_markers for select
	 	  using (auth.uid() = user_id);

	 	create policy "Modify own loop timeline markers"
	 	  on public.loop_timeline_markers for all
	 	  using (auth.uid() = user_id)
	 	  with check (auth.uid() = user_id);
	 	```

	 	- Supabase Realtime ã¯ `loop_timeline_state` / `loop_timeline_markers` ã®å¤‰æ›´ã‚’è³¼èª­ã—ã¦ã€ä»–ç«¯æœ«/ä»–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åæ˜ ã—ã¾ã™ã€‚
	 	- âš ï¸ Supabase å´ã§ **Realtime ã‚’æœ‰åŠ¹åŒ–**ã—ã¦ã„ãªã„ã¨è³¼èª­ã‚¤ãƒ™ãƒ³ãƒˆãŒé£›ã³ã¾ã›ã‚“ã€‚
	 		- Dashboard: Database â†’ Replication â†’ Realtimeï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã”ã¨ã«ON / publicationã¸è¿½åŠ ï¼‰
	 		- SQLã§è¿½åŠ ã™ã‚‹å ´åˆï¼ˆç’°å¢ƒã«ã‚ˆã‚Š publication åãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰:
	 			```sql
	 			alter publication supabase_realtime add table public.loop_timeline_state;
	 			alter publication supabase_realtime add table public.loop_timeline_markers;
	 			```

	 - **Pushé€šçŸ¥ï¼ˆsubscriptionä¿å­˜ï¼‰**
	 	- Web Push ã‚’ä½¿ã†å ´åˆã€ç«¯æœ«ã”ã¨ã®è³¼èª­æƒ…å ±ï¼ˆendpoint/éµï¼‰ã‚’ Supabase ã«ä¿å­˜ã—ã¾ã™ã€‚
	 	- ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä¾‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

	 - **ã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒ‡ã‚¤ãƒªãƒ¼/ã‚¦ã‚£ãƒ¼ã‚¯ãƒªãƒ¼/ãƒãƒ³ã‚¹ãƒªãƒ¼ï¼‰**
	 	- ç¿’æ…£ã‚¿ã‚¹ã‚¯ï¼ˆãƒã‚§ãƒƒã‚¯ã§å®Œäº†ã€æœŸé–“æ›´æ–°ã§è‡ªå‹•å¾©æ´»ï¼‰ã‚’ä¿å­˜ã—ã¾ã™ã€‚
	 	- ä¸¦ã³æ›¿ãˆï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰ã‚’åŒæœŸã—ãŸã„å ´åˆã¯ `sort_order` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
	 	- Supabase Realtime ã¯ `quest_tasks` ã®å¤‰æ›´ã‚’è³¼èª­ã—ã¦ã€ä»–ç«¯æœ«/ä»–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åæ˜ ã—ã¾ã™ã€‚
	 	- âš ï¸ Supabase å´ã§ **Realtime ã‚’æœ‰åŠ¹åŒ–**ã—ã¦ã„ãªã„ã¨è³¼èª­ã‚¤ãƒ™ãƒ³ãƒˆãŒé£›ã³ã¾ã›ã‚“ã€‚
	 		- Dashboard: Database â†’ Replication â†’ Realtimeï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã”ã¨ã«ON / publicationã¸è¿½åŠ ï¼‰
	 		- SQLã§è¿½åŠ ã™ã‚‹å ´åˆï¼ˆç’°å¢ƒã«ã‚ˆã‚Š publication åãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰:
	 			```sql
	 			alter publication supabase_realtime add table public.quest_tasks;
	 			```

	 	```sql
	 	create table public.quest_tasks (
	 	  id bigint generated by default as identity primary key,
	 	  user_id uuid not null references auth.users(id) on delete cascade,
	 	  period text not null check (period in ('daily','weekly','monthly')),
	 	  title text not null,
	 	  completed_cycle_id text,
	 	  sort_order integer not null default 0,
	 	  created_at timestamptz not null default now(),
	 	  updated_at timestamptz not null default now()
	 	);

	 	alter table public.quest_tasks enable row level security;

	 	create policy "Read own quest tasks"
	 	  on public.quest_tasks for select
	 	  using (auth.uid() = user_id);

	 	create policy "Modify own quest tasks"
	 	  on public.quest_tasks for all
	 	  using (auth.uid() = user_id)
	 	  with check (auth.uid() = user_id);
	 	```
	 	```sql
	 	create table public.push_subscriptions (
	 	  id bigint generated by default as identity primary key,
	 	  user_id uuid not null references auth.users(id) on delete cascade,
	 	  endpoint text not null,
	 	  p256dh text not null,
	 	  auth text not null,
	 	  user_agent text,
	 	  timezone_offset_minutes integer,
	 	  is_active boolean not null default true,
	 	  last_seen_at timestamptz,
	 	  created_at timestamptz not null default now(),
	 	  updated_at timestamptz not null default now(),
	 	  unique (user_id, endpoint)
	 	);

	 	alter table public.push_subscriptions enable row level security;

	 	create policy "Read own push subscriptions"
	 	  on public.push_subscriptions for select
	 	  using (auth.uid() = user_id);

	 	create policy "Modify own push subscriptions"
	 	  on public.push_subscriptions for all
	 	  using (auth.uid() = user_id)
	 	  with check (auth.uid() = user_id);
	 	```

	 	- é€ä¿¡å´ï¼ˆCloudflare Workers ãªã©ï¼‰ã§é‡è¤‡é€ä¿¡ã‚’é˜²ããªã‚‰ã€é€ä¿¡ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ç”¨æ„ã™ã‚‹ã®ãŒå®‰å…¨ã§ã™ã€‚
	 	  ä¾‹ï¼ˆã€Œç«¯æœ«(endpoint) + äºˆå®šID + é€šçŸ¥index + ç™ºç«æ™‚åˆ»ã€ã§ä¸€æ„ã«ã™ã‚‹ï¼‰:

	 	```sql
	 	create table public.push_send_log (
	 	  id bigint generated by default as identity primary key,
	 	  user_id uuid not null references auth.users(id) on delete cascade,
	 	  endpoint text not null,
	 	  schedule_id uuid,
	 	  notification_index integer,
	 	  fire_at timestamptz not null,
	 	  created_at timestamptz not null default now(),
	 	  unique (user_id, endpoint, schedule_id, notification_index, fire_at)
	 	);

	 	alter table public.push_send_log enable row level security;

	 	create policy "Read own push log"
	 	  on public.push_send_log for select
	 	  using (auth.uid() = user_id);

	 	create policy "No client writes push log"
	 	  on public.push_send_log for insert
	 	  with check (false);
	 	```
	 	- â€» `push_send_log` ã¯ Cron é€ä¿¡å´ï¼ˆservice roleï¼‰ã ã‘ãŒæ›¸ãè¾¼ã‚€æƒ³å®šã§ã™ã€‚

## Pushé€šçŸ¥ï¼ˆCloudflare Workers é€£æºï¼‰

ã“ã®ã‚¢ãƒ—ãƒªï¼ˆCloudflare Pagesï¼‰ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã„ã¦ã‚‚é€šçŸ¥ã‚’å‡ºã™ã«ã¯ Web Push ãŒå¿…è¦ã§ã™ã€‚

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã“ã®ã‚¢ãƒ—ãƒªï¼‰
	- è¨­å®šç”»é¢ã‹ã‚‰ã€ŒPushé€šçŸ¥ã€ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€Service Worker ãŒè³¼èª­æƒ…å ±ï¼ˆsubscriptionï¼‰ã‚’ä½œæˆã—ã¦ Supabase ã«ä¿å­˜ã—ã¾ã™ã€‚
	- iOS Safari ã¯ã€Œå…±æœ‰ â†’ ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ãŸã‚¢ãƒ—ãƒªã‹ã‚‰è¨±å¯/è³¼èª­ã—ã¦ãã ã•ã„ï¼ˆiOS 16.4+ï¼‰ã€‚

- ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆCloudflare Workers + Cronï¼‰
	- æ¯åˆ†ãªã©ã§ Supabase ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€Œä»Šé€ã‚‹ã¹ãé€šçŸ¥ã€ã‚’é€ä¿¡ã—ã¾ã™ã€‚
	- Push ã® payload ã« `url: "/#date=YYYY-MM-DD"` ã‚’å…¥ã‚Œã‚‹ã¨ã€é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“æ—¥ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’é–‹ã‘ã¾ã™ï¼ˆæ—¢å­˜ã® deep link å‡¦ç†ã‚’æµç”¨ï¼‰ã€‚

### VAPIDéµã®ä½œæˆ

VAPIDéµã¯ã€Œå…¬é–‹éµï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ï¼‰ã€ã¨ã€Œç§˜å¯†éµï¼ˆé€ä¿¡å´ç”¨ï¼‰ã€ã®ãƒšã‚¢ã§ã™ã€‚

- å…¬é–‹éµ: `VITE_VAPID_PUBLIC_KEY` ã«è¨­å®š
- ç§˜å¯†éµ: Workers ã® Secretï¼ˆ`VAPID_PRIVATE_KEY_PKCS8`ï¼‰ã«è¨­å®š

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ Workers ã§æ‰±ã„ã‚„ã™ã„å½¢å¼ï¼ˆprivateKeyã¯PKCS8ï¼‰ã§å‡ºåŠ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åŒæ¢±ã—ã¦ã„ã¾ã™ã€‚

```bash
node scripts/generate-vapid-keys.cjs
```

å‡ºåŠ›ã•ã‚Œã‚‹å€¤ã‚’ä»¥ä¸‹ã«è¨­å®šã—ã¦ãã ã•ã„:

- Pages ç’°å¢ƒå¤‰æ•°: `VITE_VAPID_PUBLIC_KEY`
- Workers Secrets: `VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY_PKCS8`

### é€ä¿¡å´ãŒæŒã¤ã¹ãSecretsï¼ˆä¾‹ï¼‰

- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`
- `VAPID_PUBLIC_KEY`
- `VAPID_PRIVATE_KEY_PKCS8`
- `PUBLIC_APP_URL`ï¼ˆä¾‹: `https://the-schedule.pages.dev`ï¼‰

### Workers ã®ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ / ãƒ‡ãƒ—ãƒ­ã‚¤

ãƒªãƒã‚¸ãƒˆãƒªãƒ«ãƒ¼ãƒˆã‹ã‚‰ä»¥ä¸‹ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼ˆ`workers/` ã«ç§»å‹•ä¸è¦ï¼‰:

```bash
# Workers (wrangler) ã® dev
npm run workers:dev

# deploy
npm run workers:deploy
```

## Google OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

Google Cloud Console ã§ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

- `http://localhost:5173/auth/callback`
- Cloudflare Pages ã®å…¬é–‹ URLï¼ˆä¾‹: `https://<your-pages>.pages.dev/auth/callback`ï¼‰

å–å¾—ã—ãŸã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã¯ Supabase ã® Auth è¨­å®šã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

## é–‹ç™ºæ‰‹é †

```bash
npm install
cp .env.example .env # å¿…è¦ã«å¿œã˜ã¦å€¤ã‚’ç·¨é›†

# Web (Vite) é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev
```

- ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã¯ `http://localhost:5173` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ç¢ºèªã§ãã¾ã™ã€‚

## ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤

### Web (Cloudflare Pages)

1. Cloudflare Pages ã§æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’ `npm run build`ã€ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ `dist` ã«è¨­å®šã—ã¾ã™ã€‚
2. Pages ã®ç’°å¢ƒå¤‰æ•°ã« `.env` ã¨åŒã˜ã‚­ãƒ¼ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
3. ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€è©²å½“ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ `VITE_SUPABASE_REDIRECT_URL` ã¨ Supabase / Google OAuth ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã«è¿½åŠ ã—ã¾ã™ã€‚

## æ—¢çŸ¥ã®æ³¨æ„ç‚¹

- ESLint ã® hook ä¾å­˜é–¢ä¿‚ã«é–¢ã™ã‚‹è­¦å‘ŠãŒä¸€éƒ¨æ®‹ã£ã¦ã„ã¾ã™ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ç”±æ¥ï¼‰ã€‚å‹•ä½œã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ãŒã€ä»Šå¾Œã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§æ•´ç†äºˆå®šã§ã™ã€‚
- Supabase ã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚„ Row Level Security ãƒãƒªã‚·ãƒ¼ã¯ç”¨é€”ã«ã‚ˆã£ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚
- Cloudflare Pages ã§ SPA ã‚’å‹•ä½œã•ã›ã‚‹éš›ã¯ã€`/_routes.json` ã‚„ `_redirects` ã‚’è¿½åŠ ã—ã¦å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ `index.html` ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ã‚‹ã¨ç¢ºå®Ÿã§ã™ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨­å®šã—ã¦ãã ã•ã„ï¼‰ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯å…ƒã€…ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªåŒæ§˜ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚ªãƒ¼ãƒŠãƒ¼ã®æ„å‘ã«å¾“ã£ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚
